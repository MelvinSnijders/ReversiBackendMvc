"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var FeedbackWidget=function(){function e(t){_classCallCheck(this,e),this._elementId=t}return _createClass(e,[{key:"elementId",get:function(){return this._elementId}},{key:"show",value:function(e,t,n){var o=this,a=$("#".concat(this.elementId));switch(a.css("display","none"===a.css("display")&&"block"),$("#".concat(this.elementId," .widget__text")).text(e),t){case"success":a.addClass("widget--state-success");break;case"danger":default:a.addClass("widget--state-danger")}n||this.log({message:e,type:t}),this._timeout&&clearTimeout(this._timeout),this._shown&&a.shake(),this._timeout=setTimeout(function(){return o.hide()},1800),this._shown=!0}},{key:"hide",value:function(){this._shown=!1;var e=$("#".concat(this.elementId));e.css("display","block"===e.css("display")&&"none")}},{key:"log",value:function(e){var t,n=JSON.parse(null!==(t=localStorage.feedback_widget)&&void 0!==t?t:"[]");n.length>=10&&n.pop(),n.unshift(e),localStorage.feedback_widget=JSON.stringify(n)}},{key:"removeLog",value:function(){localStorage.removeItem("feedback_widget")}},{key:"history",value:function(){var e,t=JSON.parse(null!==(e=localStorage.feedback_widget)&&void 0!==e?e:"[]"),n=t.map(function(e){return"".concat(e.type," - ").concat(e.message)}).join("\n");this.show(n,"success",!0)}}]),e}();jQuery.fn.shake=function(e,t,n){e=void 0===e?100:e,t=void 0===t?10:t,n=void 0===n?3:n;for(var o=$(this),a=0;a<n+1;a++)o.animate({left:a%2==0?t:-1*t},e);return o.animate({left:0},e)};var apiUrl="url/super/duper/game",Game=function(e){var t={apiUrl:e};return{init:function(e){console.log(t.apiUrl),Game.API.init(),Game.Reversi.init(),Game.Reversi.placeCatFact(),Game.SignalR.init(),e()}}}(apiUrl);Game.API=function(){return{init:function(){console.log("API init voltooid")},getCatFact:function(){return Game.Data.get("https://meowfacts.herokuapp.com/")}}}(),Game.Data=function(){var e={mock:[{url:"api/Spel/Beurt",data:0},{url:"https://meowfacts.herokuapp.com/",data:{data:["A cats field of vision is about 185 degrees."]}}],apiKey:"2bce53e0f162422c7108493ce597d291"},t={environment:"production"},n=function(t){var n=e.mock;return new Promise(function(e,o){var a=n.filter(function(e){return e.url===t});a.length>0?e(a[0].data):o("No mock data found for url: "+t)})},o=function(e){return"production"===t.environment?$.get(e).catch(function(e){console.log(e.message)}):"development"===t.environment?n(e):void 0};return{init:function(e){if(console.log("Init vanuit Data!"),"development"!==e&&"production"!==e)throw new Error("Environment must be production or development.");t.environment=e},get:o}}(),Game.Model=function(){var e=new FeedbackWidget("reversi-feedback");return{init:function(){console.log("Init vanuit Model!")},widget:e}}(),Game.Reversi=function(){var e={game:null},t={0:"Geen",1:"Wit",2:"Zwart"},n=function(){console.log("Initiating Reversi board");for(var e=$(".reversi-board"),t=function(t){for(var n=function(n){var o=$('<div class="reversi-board__cell" data-row="'.concat(t,'" data-column="').concat(n,'"></div>'));o.on("click",function(e){Game.SignalR.sendMove(t-1,n-1,!1)}),e.append(o)},o=1;o<=8;o++)n(o)},n=1;n<=8;n++)t(n)},o=function(e,t,n){var o=$('[data-row="'.concat(e,'"][data-column="').concat(t,'"]')),a=$("<div class='reversi-board__fiche animate__animated animate__bounceIn'></div>");o.children().length>0||("white"===n?a.addClass("reversi-board__fiche--white"):"black"===n&&a.addClass("reversi-board__fiche--black"),o.append(a))},a=function(){console.log("Refreshing board"),console.log(e.game);for(var t=0;t<8;t++)for(var n=0;n<8;n++){var a=e.game.Board[t][n],i=$('[data-row="'.concat(t+1,'"][data-column="').concat(n+1,'"]')),r=i.children().first();0===a?i.empty():1===a?(r.hasClass("reversi-board__fiche--black")&&i.empty(),o(t+1,n+1,"white")):2===a&&(r.hasClass("reversi-board__fiche--white")&&i.empty(),o(t+1,n+1,"black"))}},i=function(){console.log("Updating turn"),$("#reversi-turn").text(t[e.game.PlayerTurn])};return{init:n,placeFiche:o,placeCatFact:function(){Game.API.getCatFact().then(function(e){console.log("Placing cat fact on page."),console.log(e);var t=e.data[0],n=$("#reversi-cat-fact"),o=Game.Template.parseTemplate("api.catfact",{catFact:t});console.log(o),n.html(o)})},setGame:function(t){console.log("Setting game"),e.game=t,console.log(e.game),a(),i()},handleMoveResult:function(e){switch(e){case 2:console.log("Invalid move!"),Game.Model.widget.show("Dit is geen geldige zet!","danger");break;case 3:console.log("Not your turn!"),Game.Model.widget.show("Het is niet jouw beurt!","danger")}}}}(),Game.SignalR=function(){var e={connection:null},t=function(){e.connection.on("GameState",function(e){console.log("Received new game state: "+e),Game.Reversi.setGame(JSON.parse(e))}),e.connection.on("MoveResult",Game.Reversi.handleMoveResult)};return{init:function(){e.connection=(new signalR.HubConnectionBuilder).withUrl("/reversiHub").build(),e.connection.start(),t()},sendMove:function(t,n,o){console.log("Sending move"),e.connection.invoke("Move",t,n,o).catch(function(e){return console.error(e.toString())})}}}(),Game.Stats=function(){return{init:function(){console.log("Stats init voltooid")}}}(),Game.Template=function(){var e=function(e){var t=spa_templates.templates;return e.split(".").forEach(function(e){return t=t[e]}),t};return{getTemplate:e,parseTemplate:function(t,n){return e(t)(n)}}}();